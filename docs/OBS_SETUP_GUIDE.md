# 🎥 OBS Studio 完全設定ガイド

VRabaterのアバターをZoom/Discord/Teamsで配信するための設定手順です。

---

## 📋 前提条件

以下がすべて起動していること:
- ✅ Web UI (localhost:5173)
- ✅ Gateway (localhost:8080) 
- ✅ AI Service (localhost:5000)
- ✅ OpenSeeFace (顔トラッキング)

---

## 🚀 OBS Studio セットアップ

### ステップ1: OBS Studio起動

1. **OBS Studio**を起動
2. 初回起動の場合、「自動構成ウィザード」が表示されたら**キャンセル**

---

### ステップ2: シーン作成

1. 左下「シーン」パネルで **右クリック**
2. 「追加」→ 名前: `VRabater` と入力
3. OK

---

### ステップ3: ブラウザソース追加 ⭐

これが最重要!アバターを表示します。

1. 「ソース」パネルで **「+」** をクリック
2. **「ブラウザ」** を選択
3. 名前: `VRabater Avatar` と入力 → OK

#### ブラウザソースの設定:

```
URL: http://localhost:5173
幅: 1920
高さ: 1080
FPS: 60
```

#### 重要: カスタムCSS設定
「カスタムCSS」欄に以下を**必ず**入力してください(背景透過のため):

```css
body { 
  background-color: rgba(0, 0, 0, 0); 
  margin: 0px auto; 
  overflow: hidden; 
}
```

#### その他の設定:
- ☑️ **「ページが表示されていないときにソースをシャットダウン」のチェックを外す**
- ☑️ 「ブラウザソースのハードウェアアクセラレーションを使用」にチェック
- OK をクリック

---

### ステップ4: 背景追加(オプション)

透明背景だけだと寂しい場合、背景を追加:

1. 「ソース」→「+」→「画像」
2. 好きな背景画像を選択
3. ドラッグで**一番下**に移動(アバターが前に来るように)

または、単色背景:
1. 「ソース」→「+」→「色ソース」
2. 好きな色を選択(例: 翠青 #1E6F68)

---

### ステップ5: クロマキー設定(オプション)

より美しい背景透過のため:

1. **「VRabater Avatar」ソースを右クリック**
2. 「フィルタ」をクリック
3. 左下の「+」→「クロマキー」を選択
4. 以下のように設定:

```
色キーの種類: 緑
類似性: 400
滑らかさ: 80
キーカラー流出低減: 100
輝度: 1.00
コントラスト: 1.00
```

5. 完了をクリック

---

### ステップ6: 仮想カメラ設定

#### Windowsの場合:

1. OBS上部メニュー「ツール」→「仮想カメラ」
   - または、右下の **「仮想カメラ開始」** ボタンをクリック

2. 設定を確認:
   - 出力の種類: プログラム
   - 出力解像度: 1920x1080
   - ターゲットFPS: 60

3. **「仮想カメラ開始」** をクリック

✅ ボタンが **「仮想カメラ停止」** に変わったら成功!

---

### ステップ7: Zoom/Discordで使用

#### Zoom設定

1. Zoomを起動
2. 設定(⚙️)→「ビデオ」
3. カメラ: **「OBS Virtual Camera」** を選択
4. ミーティングに参加して確認!

#### Discord設定

1. Discord起動
2. ユーザー設定(⚙️)→「音声・ビデオ」
3. カメラ: **「OBS Virtual Camera」** を選択
4. 「ビデオをテスト」でアバターが表示されるか確認

#### Microsoft Teams設定

1. Teams起動
2. 設定→「デバイス」
3. カメラ: **「OBS Virtual Camera」** を選択

---

## 🎨 画質向上のコツ

### 1. OBSの出力設定

**設定(ファイル→設定)→映像:**
```
基本(キャンバス)解像度: 1920x1080
出力(スケーリング)解像度: 1920x1080
縮小フィルタ: ランチョス
FPS共通値: 60
```

### 2. ブラウザソースの最適化

**ブラウザソースのプロパティで:**
- FPS: 60
- ハードウェアアクセラレーション: ON
- 幅/高さ: 1920x1080

### 3. フィルタで美化

**VRabater Avatarソースを右クリック→フィルタ:**

#### 色補正
- 明るさ: +0.10
- コントラスト: +0.05
- 彩度: +0.10

#### シャープ
- シャープネス: 0.10

#### アンチエイリアス
- エッジ検出: オン

---

## 🎤 音声設定

### マイク音声をそのまま使う場合

OBSで特に設定不要。Zoom/Discordの通常マイク設定を使用。

### VRabaterのボイスチェンジャーを配信する場合

1. **VB-CABLE** をインストール
   - https://vb-audio.com/Cable/
   
2. VRabaterの音声出力先を **CABLE Input** に設定

3. Zoom/Discordのマイク入力を **CABLE Output** に設定

これで、AI音声がZoom/Discordに流れます!

---

## ⚡ パフォーマンス最適化

### 遅延を減らす

**設定→詳細設定:**
```
プロセス優先度: 高
レンダリング遅延: オフ
```

**設定→映像:**
```
FPS共通値: 30 (CPUが重い場合)
```

### CPU使用率を下げる

1. 解像度を下げる: 1280x720
2. FPSを下げる: 30fps
3. ブラウザソースのハードウェアアクセラレーション: ON

---

## 🐛 トラブルシューティング

### 仮想カメラが表示されない

**解決策:**
1. OBSを管理者権限で起動
2. PCを再起動
3. OBSを再インストール

### アバターが表示されない

**チェック項目:**
- [ ] localhost:5173 がブラウザで開けるか確認
- [ ] カスタムCSS が正しく入力されているか
- [ ] 「シャットダウン」のチェックが外れているか
- [ ] Gateway/OpenSeeFaceが起動しているか

### 背景が透明にならない

**解決策:**
1. カスタムCSSを再確認
2. クロマキーフィルタを追加
3. 色ソースで背景色を設定

### 映像がカクカクする

**解決策:**
1. FPSを60→30に下げる
2. 解像度を1920x1080→1280x720に
3. ブラウザのタブを閉じる(メモリ確保)
4. OBSのプロセス優先度を「高」に

### 音声と映像がズレる

**解決策:**
1. VRabater Avatarソース右クリック→「フィルタ」
2. 「+」→「遅延追加」
3. 遅延時間: -50ms 〜 -200ms で調整

---

## 📸 録画・配信設定(ボーナス)

### 録画したい場合

1. 設定→「出力」
2. 録画フォーマット: mp4
3. エンコーダ: x264 または NVIDIA NVENC H.264(GPUがある場合)
4. 品質: 高品質、ファイルサイズ中
5. 「録画開始」で保存開始!

### YouTubeライブ配信

1. 設定→「配信」
2. サービス: YouTube - RTMPS
3. ストリームキー: YouTubeから取得して貼り付け
4. 「配信開始」!

---

## ✅ 最終チェックリスト

配信前に確認:

- [ ] OBS起動
- [ ] VRabater Avatar ソース追加(localhost:5173)
- [ ] カスタムCSS設定
- [ ] 背景追加(オプション)
- [ ] 仮想カメラ開始
- [ ] Zoom/Discordでカメラ選択
- [ ] マイクテスト
- [ ] 顔トラッキング動作確認(まばたき、口の動き)
- [ ] 表情テスト(笑顔、驚き)

---

## 🎉 完了!

これで準備完了です!

**Zoom/Discord/Teamsで「OBS Virtual Camera」を選択すれば、VRabaterの超かわいいアバターで会議に参加できます!** 🚀✨

---

## 📚 次のステップ

- 体トラッキング追加 (`docs/FULLBODYTRACKING.md`)
- AI会話機能を試す (マイクで話しかける)
- 背景をカスタマイズ
- うぐいすがかわいく動いているか確認 🐦

楽しんでください! 😊
